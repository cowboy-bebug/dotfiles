#!/usr/bin/env bash

# Default values
title=""

# Function to show usage
show_usage() {
  echo "Usage: $(basename "$0") [OPTIONS]"
  echo ""
  echo "OPTIONS:"
  echo "  -t, --title <title>  Title of the blog post (required)"
  echo "  -h, --help          Show this help message"
  echo ""
  echo "Examples:"
  echo "  $(basename "$0") --title \"My Blog Post\""
}

# Parse command line arguments
while [[ $# -gt 0 ]]; do
  case $1 in
  -t | --title)
    title="$2"
    shift 2
    ;;
  -h | --help)
    show_usage
    exit 0
    ;;
  *)
    echo "Error: Unknown option '$1'"
    echo ""
    show_usage
    exit 1
    ;;
  esac
done

# Check if title is provided
if [ -z "$title" ]; then
  echo "Error: Title is required"
  echo ""
  show_usage
  exit 1
fi

# Construct the target directory
base_dir="$HOME/github.com/cowboy-bebug/ericlim.dev"
out_dir="$base_dir/src/content/post"

# Check if target directory exists
if [ ! -d "$out_dir" ]; then
  echo "Error: Directory '$out_dir' does not exist"
  exit 1
fi

timestamp=$(date +"%Y%m%d%H%M")
slug=$(echo "$title" | tr '[:upper:]' '[:lower:]' | sed -E 's/[^a-z0-9 ]//g' | tr ' ' '-')

file_name="${timestamp}-${slug}.md"
file_path="${out_dir}/${file_name}"

cat <<EOF >"$file_path"
---
title: "$title"
description: ""
tags: []
publishDate: $(gdate +"%Y-%m-%dT%H:%M:%S%:z")
coverImage:
  src: ""
  alt: ""
seriesId: ""
orderInSeries:
---

Start writing your post here...
EOF

echo "Created: $file_path"

cursor --new-window "$base_dir" --goto "$file_path"
